language: ruby
cache: bundler
rvm:
  - 2.6.0
# dist: trusty
# addons:
#   chrome: stable
# before_install:
#   - # start your web application and listen on `localhost`
#   - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9222 http://localhost &
#   â‹®
services:
  - postgresql
  - xvfb
env:
  - DB=postgres
dist: xenial
before_install:
  - "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1280x1024x16"
before_script:
  - cp config/database.yml.travis config/database.yml
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start
script:
  - bundle exec rails db:setup RAILS_ENV=test
  - bundle exec rspec
  - xvfb-run --server-args="-screen 0 1024x768x24" make test